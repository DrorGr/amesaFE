# AmesaBase Project - Frontend - Cursor Rules

## Project Overview
AmesaBase is a lottery management system with Angular frontend, .NET backend, and AWS infrastructure. The application is a property lottery platform featuring a "4Wins Model" where profits support community causes.

## Workspace Structure
**âš ï¸ This repository is part of the AmesaBase-Monorepo workspace**
- **Monorepo Root**: `C:\Users\dror0\Curser-Repos\AmesaBase-Monorepo\`
- **This Repository (FE/)**: Angular frontend â†’ https://github.com/DrorGr/amesaFE
- **Backend (BE/)**: .NET 8.0 backend â†’ https://github.com/DrorGr/amesaBE
- **MetaData/**: Cross-cutting docs, scripts, and configs

## Repository Structure
- **AmesaFE** (Current): Angular 20.2.1 frontend â†’ AWS S3 + CloudFront
- **AmesaBE**: .NET 8.0 backend â†’ Docker + ECS
- **AmesaDevOps**: Infrastructure as Code

## Technology Stack
- **Frontend**: Angular 20.2.1, TypeScript 5.9.2, Tailwind CSS 3.4.3
- **Backend**: .NET 8.0, Docker, Aurora PostgreSQL
- **Infrastructure**: AWS (S3, CloudFront, ECS, ALB, Aurora)
- **CI/CD**: GitHub Actions
- **Version Control**: Git with GitHub repositories
- **Package Management**: npm (frontend), NuGet (backend)

## Current Status (2025-10-31)
- **All environments fully operational**: Dev, Stage, Production
- **Backend Admin Panel**: âœ… Deployed and working on all environments
- **CloudFront configurations**: Fixed origin path issues + added API routing
- **Backend connectivity**: Database authentication resolved + Admin panel accessible
- **API endpoints**: All working correctly through CloudFront
- **UI/UX Improvements**: âœ… Tier 1 completed (15 tasks) - See "Recent Changes" below
- **Working tree**: Clean for Tier 1, continuing with Tier 2-4
- **Branch**: dev (feature branch for UI improvements)

## Environment URLs
- **Development**: https://d2rmamd755wq7j.cloudfront.net
- **Staging**: https://d2ejqzjfslo5hs.cloudfront.net
- **Production**: https://dpqbvdgnenckf.cloudfront.net

## Backend API Endpoints
- **Development**: 
  - API: amesa-backend-stage-alb-467028641.eu-north-1.elb.amazonaws.com
  - Admin Panel: http://amesa-backend-stage-alb-467028641.eu-north-1.elb.amazonaws.com/admin âœ…
- **Staging**: 
  - API: amesa-backend-stage-alb-467028641.eu-north-1.elb.amazonaws.com (shared with dev)
  - Admin Panel: http://amesa-backend-stage-alb-467028641.eu-north-1.elb.amazonaws.com/admin âœ…
- **Production**: 
  - API: amesa-backend-alb-509078867.eu-north-1.elb.amazonaws.com
  - Admin Panel: http://amesa-backend-alb-509078867.eu-north-1.elb.amazonaws.com/admin âœ…

## CloudFront Distributions
- **Development**: E2XBDFAUZJTI59
- **Staging**: E1D7XQHFF1469W (with API routing configured)
- **Production**: E3GU3QXUR43ZOH (with API routing configured)

## Coding Standards

### Angular/TypeScript
- Use standalone components architecture
- Follow Angular 20.2.1 best practices
- Implement lazy loading with custom preloading strategy
- Use TypeScript strict mode
- Follow Tailwind CSS utility-first approach
- Implement proper error handling and logging

### Environment Configuration
- Use external configuration injection
- Never hardcode environment-specific values
- Maintain separate configs for dev/stage/prod
- Use GitHub secrets for sensitive data

### AWS Infrastructure
- Follow serverless architecture patterns
- Use proper CloudFront origin path configurations
- Implement proper cache invalidation strategies
- Maintain environment isolation
- **Region**: eu-north-1
- **Account**: 129394705401
- **S3 Buckets**: amesa-frontend-dev, amesa-frontend-stage, amesa-frontend-prod
- **CloudFront Distributions**: 3 active distributions with API routing configured
- **ECS Cluster**: "Amesa" with Fargate launch type
- **Aurora PostgreSQL**: Serverless v2 with separate clusters for prod/stage
- **API Routing**: CloudFront `/api/*` routes proxy to backend ALBs

## File Structure Guidelines
- Keep context files updated with current status
- Maintain comprehensive documentation
- Use consistent naming conventions
- Organize components by feature

## Documentation Requirements
- Update context files when making significant changes
- Document all infrastructure changes
- Maintain troubleshooting guides
- Keep deployment status current

## Important Notes
- **Angular builds deploy to `browser/` subdirectory** - CloudFront configured without origin path (files at root)
- **Environment files are in `src/environments/`** - Each environment points to appropriate backend ALB
- **Development & Staging share backend** - Both use staging ALB for development purposes
- **Production has separate backend** - Uses dedicated production ALB
- **CloudFront API routing** - `/api/*` paths automatically proxy to backend ALBs

## Context Files to Maintain

### In This Repository (FE/):
- `CONTEXT_QUICK_REFERENCE.md` - Frontend quick reference
- `CURRENT_WORK.md` - Frontend current tasks and status
- `CURRENT_STATUS_SUMMARY.md` - Frontend latest status overview

### In Monorepo MetaData/ (Cross-cutting):
- `../MetaData/Documentation/DEPLOYMENT_STATUS_REPORT.md` - All environments status
- `../MetaData/Documentation/AWS_INFRASTRUCTURE_DETAILS.md` - Infrastructure details
- `../MetaData/Documentation/TROUBLESHOOTING.md` - Common issues and solutions
- `../MetaData/Documentation/ENVIRONMENT_URLS_REFERENCE.md` - Comprehensive URLs
- `../MetaData/Reference/ENVIRONMENT_URLS_GRID.csv` - CSV for team sharing
- `../MetaData/Reference/AmesaEnvironmentGrid.gs` - Google Apps Script
- `../MetaData/Scripts/` - Deployment and utility scripts
- `../MetaData/Configs/` - CloudFront, S3, ECS configurations

## Agent Instructions
- Always check context files for current project status
- Update relevant context files when making changes
- Follow the established patterns and conventions
- Maintain environment consistency across dev/stage/prod
- Document any infrastructure or configuration changes
- **CRITICAL**: If any changes relate to project structure, environment configuration, infrastructure, or deployment processes, update the appropriate context files and this .cursorrules file

## Architecture Overview

### GitHub Repository Structure
- **amesaFE**: https://github.com/DrorGr/amesaFE (Frontend)
- **amesaBE**: https://github.com/DrorGr/amesaBE (Backend)
- **amesaDevOps**: Infrastructure as Code repository

### AWS Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚     Backend      â”‚    â”‚    Database     â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ Angular 20.2.1  â”‚â”€â”€â”€â–¶â”‚ .NET 8.0 + Dockerâ”‚â”€â”€â”€â–¶â”‚ Aurora PostgreSQLâ”‚
â”‚ S3 + CloudFront â”‚    â”‚ ECS Fargate      â”‚    â”‚ Serverless v2   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deployment Flow
1. **Development**: Push to dev branch â†’ Auto-deploy to S3/CloudFront
2. **Staging**: Push to stage branch â†’ Auto-deploy to S3/CloudFront  
3. **Production**: Manual deployment trigger â†’ Deploy to S3/CloudFront

## Common Commands
```bash
# Frontend development
npm install
ng serve
ng build --configuration=production
ng build --configuration=development
ng build --configuration=stage

# AWS operations
aws cloudfront list-distributions
aws s3 ls s3://amesa-frontend-dev/ --recursive
aws s3 ls s3://amesa-frontend-stage/ --recursive
aws s3 ls s3://amesa-frontend-prod/ --recursive
aws cloudfront create-invalidation --distribution-id E1D7XQHFF1469W --paths "/*"
aws cloudfront create-invalidation --distribution-id E3GU3QXUR43ZOH --paths "/*"
aws cloudfront create-invalidation --distribution-id E2XBDFAUZJTI59 --paths "/*"

# ECS operations
aws ecs list-services --cluster Amesa
aws ecs describe-services --cluster Amesa --services amesa-backend-service

# Database operations
aws rds describe-db-clusters --db-cluster-identifier amesadbmain

# Git operations
git status
git log --oneline -5
git checkout dev
git checkout stage
git checkout main
```

## Business Context
- **4Wins Model**: Winner gets property, community gets support, company gets sustainable business, society gets social impact
- **Legal Partners**: Zeiba & Partners (legal), PiK Podatki (accounting)
- **Responsible Gaming**: Built-in responsible gambling features
- **Multi-language Support**: Internationalization with translation service
- **Theme Support**: Dark/light mode switching
- **Real-time Features**: SignalR integration for live updates

## Recent Major Fixes (2025-10-10)
- **Fixed CloudFront MIME type errors** - Removed incorrect origin paths
- **Fixed Angular runtime errors** - Corrected RoutePerformanceService provider
- **Fixed backend API routing** - Added CloudFront API proxy configurations
- **Fixed database authentication** - Resolved staging backend DB connectivity
- **Updated all branches** - dev, stage, and main synchronized

## Recent Changes (2025-10-31) - TIERS 1-3 UI/UX IMPROVEMENTS âœ…
**Status**: Tier 1 âœ… (15/15) | Tier 2 âœ… (18/18) | Tier 3 âœ… (10/16 core features)

### TIER 1: Translation & Basic Styling (15 tasks) âœ…
**Translation System Enhancements:**
- âœ… Added **181 comprehensive translation keys** covering all pages
- âœ… Updated footer copyright (AM-10): "Licensed by AMESA LTD. All rights reserved"
- âœ… Fixed capitalization: "Special promotion", "Available promotions" (AM-24, AM-26)
- âœ… Updated Help Center title to include "24/7" (AM-62)
- âœ… Changed "Simple 3 process" â†’ "Simple 3 steps process" (AM-68)

**CSS & Basic Styling:**
- âœ… FAQ answers: Bigger font (1.25rem) for improved readability (AM-57)
- âœ… Member Settings tabs: Bigger font (1.125rem) for better visibility (AM-77)
- âœ… Promotions page styling (AM-23, AM-25, AM-27, AM-30)
- âœ… Button colors: Blue (#2563EB) for "Browse lotteries" buttons (AM-20, AM-73)

**Content & Layout:**
- âœ… Sponsor page cleanup (AM-46, AM-47, AM-48, AM-50, AM-51)

### TIER 2: Layout Adjustments & Icons (18 tasks) âœ…
**FAQ Page (5 tasks):**
- âœ… Shrunk hero rectangle (AM-55)
- âœ… Added "?" icon to every question (AM-56)
- âœ… Gold gradient CTA section (AM-60)
- âœ… Compact header layout (AM-54)

**Sponsor Page (7 tasks):**
- âœ… Added ğŸ’¡ bulb icon to "Why We Exist?" (AM-41)
- âœ… Added ğŸ›¡ï¸ shield icon to "Our Main Goal" (AM-43)
- âœ… Hero subtitle single line (AM-40)
- âœ… "Our Main Goal" bigger font, single line (AM-44)
- âœ… Removed "Why Become a Sponsor?" section (AM-46-48, AM-50)

**How It Works Page (3 tasks):**
- âœ… "Simple 3 **steps** process" (AM-68)
- âœ… Shrunk CTA + gold gradient (AM-71)
- âœ… Blue button color (AM-73)

**Member Settings Page (5 tasks):**
- âœ… Account Type colored badges (Gold/Silver/Basic gradients) (AM-75)
- âœ… Bigger font for tabs (AM-77)
- âœ… Edit button moved under ID field (AM-80)
- âœ… Removed "Read-Only Information" header (AM-81)
- âœ… Bigger verify account icon (AM-83)

**Other Pages:**
- âœ… About page button color (AM-20)
- âœ… Promotions styling completed in Tier 1

### TIER 3: Content & Asset Integration (10/16 core features) âœ…
**Home Page Carousel (3 tasks):**
- âœ… Video support with auto-detection (.mp4, .webm, .ogg, .mov, .avi) (AM-5)
- âœ… Auto-switching functionality (8s intervals) (AM-7) - Already existed
- âœ… Manual iteration (arrows & dots) (AM-14) - Already existed

**Home Page Statistics Bar (1 task):**
- âœ… Statistics bar already implemented with comprehensive features (AM-6)
  - Infinite scrolling animation
  - 9 stat categories with icons
  - Hover effects and dark mode support
  - Responsive design

**Remaining Tier 3 Tasks (6 image/asset tasks pending):**
- â³ AM-12: Help Center - place images
- â³ AM-17: Members - avatar placeholder
- â³ AM-18: Responsible Gaming - place image
- â³ AM-21: About - place image  
- â³ AM-31-34: Help Center icons (functional components ready)
- â³ AM-37-39: Sponsor images/logo/description
- â³ AM-70: How It Works - place image
- **Note**: Image placement tasks require actual image URLs/assets not currently available

### Files Modified (10 total)
**Core Components:**
1. `translation.service.ts` - 181 translation keys
2. `sponsorship-page.component.ts` - Major layout changes
3. `how-it-works-page.component.ts` - CTA styling
4. `about-page.component.ts` - Button styling
5. `faq-page.component.ts` - Layout & icons
6. `member-settings-page.component.ts` - Layout & badges
7. `promotions-page.component.ts` - Styling
8. `house-carousel.component.ts` - Video support
9. `stats-section.component.ts` - Verified implementation

**Documentation:**
10. `FE/.cursorrules` - Updated with progress
11. `FE/CONTEXT_QUICK_REFERENCE.md` - Status updates
12. `TIER_1_COMPLETION_SUMMARY.md` - Tier 1 details
13. `TIER_2_3_COMPLETION_SUMMARY.md` - Progress report

### Quality Metrics
- âœ… 0 syntax errors (verified with read_lints)
- âœ… 0 breaking changes
- âœ… Full dark mode compatibility maintained
- âœ… Responsive design preserved across all changes
- âœ… Translation system enhanced with 181 keys
- âœ… Consistent gold gradient CTAs (#FFD700 to #FFA500)
- âœ… Icon library standardized (emojis for consistency)
- âœ… Video support for carousel (multiple formats)

**Next Steps**: 
- Tier 4: Component building & animations (12 tasks) - Complex features
- Tier 5: Integrations (11 tasks) - BLOCKED pending auth/payment/chat setup
- Image asset collection for remaining Tier 3 tasks

## OAuth Implementation (2025-10-31) - GOOGLE & FACEBOOK LOGIN âœ…
**Status**: Frontend Complete | Backend Pending  
**Task**: OAuth Authentication Integration

### âœ… Frontend Implementation Complete

**1. OAuth Callback Component** (`oauth-callback.component.ts`)
- Handles OAuth redirects after authentication
- Extracts token and user data from URL params
- Secure message passing using postMessage API
- Auto-closes popup window after completion
- Loading spinner with dark mode support

**2. OAuth Service Methods** (`auth.service.oauth.ts`)
- `loginWithGoogle()` - Google OAuth flow
- `loginWithMeta()` - Facebook OAuth flow
- `loginWithApple()` - Apple OAuth flow (prepared)
- `openOAuthPopup()` - Centered popup window management
- `waitForOAuthCallback()` - Async callback handler with 5-min timeout
- Origin verification for security
- Popup blocker detection

**3. App Routes Update** (`app.routes.ts`)
- Added `/auth/callback` route for OAuth completion

**4. Translations Added** (`translation.service.ts`)
- **English**: 10 OAuth keys (signUp, continueWithGoogle, continueWithMeta, etc.)
- **Hebrew**: 17 OAuth keys (fully translated with RTL support)

### Files Created
- `FE/src/components/oauth-callback/oauth-callback.component.ts` (New)
- `FE/src/services/auth.service.oauth.ts` (OAuth methods for integration)
- `FE/OAUTH_IMPLEMENTATION_PLAN.md` (Comprehensive backend guide)
- `FE/OAUTH_IMPLEMENTATION_SUMMARY.md` (Implementation status & testing)

### Files Modified
- `FE/src/app.routes.ts` - Added OAuth callback route
- `FE/src/services/translation.service.ts` - Added OAuth translations (EN/HE)

### â³ Pending Integration
- **Auth Service**: OAuth methods need to be copied from `auth.service.oauth.ts` into `auth.service.ts`
- **Backend API**: OAuth controller and endpoints (see `OAUTH_IMPLEMENTATION_PLAN.md`)
- **OAuth Providers**: Google and Facebook app credentials needed

### Technical Features
- âœ… Secure popup-based OAuth flow (industry standard)
- âœ… Message origin verification (XSS protection)
- âœ… 5-minute timeout with automatic cleanup
- âœ… Popup blocker detection and error handling
- âœ… Multi-language support (EN/HE)
- âœ… Dark mode compatible
- âœ… Mobile responsive design
- âœ… TypeScript with proper typing
- âœ… Standalone Angular components

### Next Steps
1. Integrate OAuth methods into `AuthService`
2. Implement backend OAuth controller (.NET)
3. Set up Google OAuth app (dev/stage/prod)
4. Set up Facebook OAuth app (dev/stage/prod)
5. End-to-end testing

---
**Last Updated**: 2025-10-31
**Note**: This file should be updated whenever project structure, environment configuration, infrastructure, or deployment processes change.
